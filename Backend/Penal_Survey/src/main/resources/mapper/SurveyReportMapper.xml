<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.isoft.panelsurvey.mapper.SurveyReportMapper">

    <resultMap id="BaseResultMap" type="org.isoft.panelsurvey.entity.SurveyReport">
        <id column="id" property="id"/>
        <result column="project_id" property="projectId"/>
        <result column="questionnaire_id" property="questionnaireId"/>
        <result column="report_title" property="reportTitle"/>
        <result column="total_responses" property="totalResponses"/>
        <result column="valid_responses" property="validResponses"/>
        <result column="completion_rate" property="completionRate"/>
        <result column="average_duration" property="averageDuration"/>
        <result column="statistical_data" property="statisticalData"/>
        <result column="chart_data" property="chartData"/>
        <result column="preference_summary" property="preferenceSummary"/>
        <result column="key_findings" property="keyFindings"/>
        <result column="report_content" property="reportContent"/>
        <result column="pdf_path" property="pdfPath"/>
        <result column="excel_path" property="excelPath"/>
        <result column="generate_time" property="generateTime"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <select id="selectById" resultMap="BaseResultMap">
        SELECT * FROM survey_report WHERE id = #{id}
    </select>

    <select id="selectByQuestionnaireId" resultMap="BaseResultMap">
        SELECT * FROM survey_report WHERE questionnaire_id = #{questionnaireId} ORDER BY generate_time DESC LIMIT 1
    </select>

    <select id="selectByProjectId" resultMap="BaseResultMap">
        SELECT * FROM survey_report WHERE project_id = #{projectId} ORDER BY generate_time DESC
    </select>

    <insert id="insert" parameterType="org.isoft.panelsurvey.entity.SurveyReport" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO survey_report (
            project_id, questionnaire_id, report_title, total_responses, valid_responses,
            completion_rate, average_duration, statistical_data, chart_data, preference_summary,
            key_findings, report_content, pdf_path, excel_path, generate_time
        ) VALUES (
            #{projectId}, #{questionnaireId}, #{reportTitle}, #{totalResponses}, #{validResponses},
            #{completionRate}, #{averageDuration}, #{statisticalData}, #{chartData}, #{preferenceSummary},
            #{keyFindings}, #{reportContent}, #{pdfPath}, #{excelPath}, #{generateTime}
        )
    </insert>

    <update id="update" parameterType="org.isoft.panelsurvey.entity.SurveyReport">
        UPDATE survey_report
        <set>
            <if test="reportTitle != null">report_title = #{reportTitle},</if>
            <if test="totalResponses != null">total_responses = #{totalResponses},</if>
            <if test="validResponses != null">valid_responses = #{validResponses},</if>
            <if test="completionRate != null">completion_rate = #{completionRate},</if>
            <if test="averageDuration != null">average_duration = #{averageDuration},</if>
            <if test="statisticalData != null">statistical_data = #{statisticalData},</if>
            <if test="chartData != null">chart_data = #{chartData},</if>
            <if test="preferenceSummary != null">preference_summary = #{preferenceSummary},</if>
            <if test="keyFindings != null">key_findings = #{keyFindings},</if>
            <if test="reportContent != null">report_content = #{reportContent},</if>
            <if test="pdfPath != null">pdf_path = #{pdfPath},</if>
            <if test="excelPath != null">excel_path = #{excelPath},</if>
        </set>
        WHERE id = #{id}
    </update>

    <delete id="deleteById">
        DELETE FROM survey_report WHERE id = #{id}
    </delete>

</mapper>

